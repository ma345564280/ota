<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ota.dao.AppstoreMapper">
	<resultMap id="BaseResultMap" type="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="appstoreversion" property="appstoreversion"
			jdbcType="VARCHAR" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="apkdownload" property="apkdownload" jdbcType="VARCHAR" />
		<result column="apkname" property="apkname" jdbcType="VARCHAR" />
		<result column="apkicon" property="apkicon" jdbcType="VARCHAR" />
		<result column="mappingid" property="mappingid" jdbcType="VARCHAR" />
		<result column="businessid" property="businessid" jdbcType="VARCHAR" />
		<result column="apkversion" property="apkversion" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="ResultMapWithBLOBs" type="com.ota.domain.Appstore"
		extends="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<result column="apkinfo" property="apkinfo" jdbcType="LONGVARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, appstoreversion, update_time, apkdownload, apkname, apkicon,
		mappingid, businessid,
		apkversion
	</sql>
	<sql id="Blob_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		apkinfo
	</sql>


	<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~ 自定义sql~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	<select id="selectAllAppstoreInfoWithFilter" resultType="AppstoreWithAllInfo" >
	    select 
			appstore.id,
			appstore.apkdownload,
			appstore.apkicon,
			bs.name, 
			og.groupname,
			boxtype.type,
			appstore.apkversion,
			appstore.appstoreversion appstoreversion,
			appstore.enforce,
			appstore.update_time updateTime,
			appstore.status,
			appstore.description,
			appstore.mappingid
		from 
			appstore 
		LEFT JOIN 
			boxtype on boxtype.id = appstore.modelid 
		LEFT JOIN
			business bs ON appstore.businessid = bs.id
		LEFT JOIN
			otagroup og on og.id = appstore.groupid
		<where>
    	    <if test="customerid!=null">
        	    businessid=#{customerid,jdbcType=INTEGER}
       		</if>
       	 	<if test="modelid!=null ">
            	and modelid=#{modelid,jdbcType=VARCHAR}
        	</if>
    	</where>
	</select>
	<select id="selectForRoot" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from appstore
		order by update_time desc
	</select>

	<select id="selectByAppstoreversion" resultType="java.lang.String"
		parameterType="java.lang.String">
		select mappingid from appstore where
		appstoreversion=#{appstoreversion,jdbcType=VARCHAR}
	</select>

	<select id="selectAppstoreInfo" resultType="com.ota.domain.AppstoreInfo"
		parameterType="com.ota.domain.AppstoreInfo">
		select * from appstore inner join
		appstoremapping on
		appstore.businessid =
		appstoremapping.businessid and
		(appstore.mappingid like
		CONCAT('',appstoremapping.id,'')
		OR
		appstore.mappingid like
		CONCAT('%,',appstoremapping.id,',%')
		OR
		appstore.mappingid
		like CONCAT('',appstoremapping.id,',%')
		OR
		appstore.mappingid
		like
		CONCAT('%,',appstoremapping.id,''))
		and type =
		#{Type,jdbcType=VARCHAR} and
		romversion=#{RomVersion,jdbcType=VARCHAR} and
		appstoreversion=#{AppStoreVersion,jdbcType=VARCHAR}


	</select>
	<select id="selectByBusinessId" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from appstore
		where businessid = #{businessid,jdbcType=VARCHAR}
		order by
		update_time
		DESC
	</select>

	<update id="updateMappingIDByPrimaryKey" parameterType="Appstore">
		update
		appstore set mappingid=#{mappingid} where id=#{id}
	</update>


	<select id="selectlastid" resultType="int">
		select max(id) from
		appstore;
	</select>

	<update id="updateForAddFilterToMultFile" parameterType="Appstore">
		update appstore set
		mappingid = #{mappingid,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~自定义sql~~~~~~~~~~~~~~~~~~~~~~~~~ -->



	<select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from appstore
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from appstore
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into appstore (id, appstoreversion, update_time,
		apkdownload,
		apkname, apkicon,
		mappingid, businessid, apkversion,
		apkinfo)
		values
		(#{id,jdbcType=INTEGER}, #{appstoreversion,jdbcType=VARCHAR},
		#{updateTime,jdbcType=TIMESTAMP},
		#{apkdownload,jdbcType=VARCHAR},
		#{apkname,jdbcType=VARCHAR}, #{apkicon,jdbcType=VARCHAR},
		#{mappingid,jdbcType=VARCHAR}, #{businessid,jdbcType=VARCHAR},
		#{apkversion,jdbcType=VARCHAR},
		#{apkinfo,jdbcType=LONGVARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into appstore
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="appstoreversion != null">
				appstoreversion,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="apkdownload != null">
				apkdownload,
			</if>
			<if test="apkname != null">
				apkname,
			</if>
			<if test="apkicon != null">
				apkicon,
			</if>
			<if test="mappingid != null">
				mappingid,
			</if>
			<if test="businessid != null">
				businessid,
			</if>
			<if test="apkversion != null">
				apkversion,
			</if>
			<if test="apkinfo != null">
				apkinfo,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="appstoreversion != null">
				#{appstoreversion,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="apkdownload != null">
				#{apkdownload,jdbcType=VARCHAR},
			</if>
			<if test="apkname != null">
				#{apkname,jdbcType=VARCHAR},
			</if>
			<if test="apkicon != null">
				#{apkicon,jdbcType=VARCHAR},
			</if>
			<if test="mappingid != null">
				#{mappingid,jdbcType=VARCHAR},
			</if>
			<if test="businessid != null">
				#{businessid,jdbcType=VARCHAR},
			</if>
			<if test="apkversion != null">
				#{apkversion,jdbcType=VARCHAR},
			</if>
			<if test="apkinfo != null">
				#{apkinfo,jdbcType=LONGVARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update appstore
		<set>
			<if test="appstoreversion != null">
				appstoreversion = #{appstoreversion,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="apkdownload != null">
				apkdownload = #{apkdownload,jdbcType=VARCHAR},
			</if>
			<if test="apkname != null">
				apkname = #{apkname,jdbcType=VARCHAR},
			</if>
			<if test="apkicon != null">
				apkicon = #{apkicon,jdbcType=VARCHAR},
			</if>
			<if test="mappingid != null">
				mappingid = #{mappingid,jdbcType=VARCHAR},
			</if>
			<if test="businessid != null">
				businessid = #{businessid,jdbcType=VARCHAR},
			</if>
			<if test="apkversion != null">
				apkversion = #{apkversion,jdbcType=VARCHAR},
			</if>
			<if test="apkinfo != null">
				apkinfo = #{apkinfo,jdbcType=LONGVARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKeyWithBLOBs" parameterType="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update appstore
		set appstoreversion =
		#{appstoreversion,jdbcType=VARCHAR},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP},
		apkdownload =
		#{apkdownload,jdbcType=VARCHAR},
		apkname = #{apkname,jdbcType=VARCHAR},
		apkicon = #{apkicon,jdbcType=VARCHAR},
		mappingid =
		#{mappingid,jdbcType=VARCHAR},
		businessid =
		#{businessid,jdbcType=VARCHAR},
		apkversion =
		#{apkversion,jdbcType=VARCHAR},
		apkinfo =
		#{apkinfo,jdbcType=LONGVARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.ota.domain.Appstore">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update appstore
		set appstoreversion =
		#{appstoreversion,jdbcType=VARCHAR},
		update_time =
		#{updateTime,jdbcType=TIMESTAMP},
		apkdownload =
		#{apkdownload,jdbcType=VARCHAR},
		apkname = #{apkname,jdbcType=VARCHAR},
		apkicon = #{apkicon,jdbcType=VARCHAR},
		mappingid =
		#{mappingid,jdbcType=VARCHAR},
		businessid =
		#{businessid,jdbcType=VARCHAR},
		apkversion =
		#{apkversion,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
</mapper>